<!DOCTYPE html>
<html><head></head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<body><div><h2>Jd Server Interface</h2>
<button type="button" id="logon" onclick="logon()">logon</button>
user: <input type="text" id="usr" value="user0" size="6">
pswd: <input type="text" id="pwd" value="user0" size="6">
<button type="button" id="logout" onclick="logout()">logout</button>
<hr>
dan: <input type="text" id="dan" value="all" size="6">
<hr>
<button type="button" onclick="run()">run</button>
<button type="button" onclick="runnxt()">run next example</button>
<br>
<input type="text" id="cmd" size="60" value='"info summary"' onkeydown = "if (event.keyCode == 13) run('cmd')">
<br/><textarea id="out" rows=10 cols=80></textarea><br/>
</div>

<script>
var ix=-1;

let examples = [
'"info summary"',
'"info schema"',
'["delete t","a<999"]',
'["insert t","a",45,"byte","xxx"]',
'["insert t","a",[6,7,8],"byte",["qwe","rqw","erq"]]',
'"read from t"'
];

function runnxt()
{
  ix+=1;
  if(ix==examples.length) ix=0;
  idvs('cmd',examples[ix]);
  run();
}

function logon(){
  var cmd= "logon "+idv("usr")+"/"+idv("pwd");
  getdata('+ "'+cmd+'"');
}

function logout(){getdata(idv("dan")+';"logoff"');}

function run(){
  idvs("out","busy");
  getdata(idv("dan")+' '+idv('cmd'));
}

async function getdata(p) {
  const url= location.href;
  try {
    const response = await fetch(url, {method: "POST",body: p,});
    if (!response.ok) {
      throw new Error(`Response status: ${response.status}`);
    }
    const result = await response.json();
    idvs('out',JSON.stringify(result));
  } catch (error) {idvs('out',error.message);}
}

function byid(id){return document.getElementById(id);}
function idv(id){return byid(id).value;}
function idvs(id,v){byid(id).value=v;}

/* replaced by getdata
var rq;    
var busy= 0; // prevent new request until previous has completed

function ajaxrun(p)
{
 if(1==busy) {idvs("out","busy on previous request"); return;}
 busy= 1;
 rq= new XMLHttpRequest();
 rq.onreadystatechange= ajax;
 rq.open("POST","", true);
 rq.send(p);
}

function ajax()
{
  if(rq.readyState==4)
  {
    busy= 0;
    t= rq.responseText;
    idvs("out",t);
  }
}

function run()
{
  idvs("out","busy");
  idvs("cmd",idv("cmd"));
  ajaxrun(idv("dan")+';'+idv("cmd"));
}
*/
</script>
</body></html>
